name: Build E2B Template

on:
  workflow_dispatch: # 手动触发
  push:
    branches:
      - main
    paths:
      - 'Dockerfile'
      - 'e2b.toml'
      - 'package.json'

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install E2B CLI
        run: npm install -g @e2b/cli
      
      - name: Build E2B Template
        env:
          E2B_ACCESS_TOKEN: ${{ secrets.E2B_ACCESS_TOKEN }}
        run: |
          e2b template build --name x-pilot-remotion-template
      
      - name: List templates
        env:
          E2B_ACCESS_TOKEN: ${{ secrets.E2B_ACCESS_TOKEN }}
        run: e2b template list
