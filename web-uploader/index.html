<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœºæ™¯ä¸Šä¼ ç®¡ç†å™¨ - X-Pilot Video Render</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#8b5cf6',
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
    }
    .code-editor {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen text-white">
  <div id="app"></div>
  
  <script type="module">
    import { createApp, ref, computed, onMounted } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js'

    const API_BASE = 'http://localhost:8000'

    createApp({
      setup() {
        // çŠ¶æ€ç®¡ç†
        const activeTab = ref('upload')
        const scenes = ref([])
        const manifest = ref(null)
        const loading = ref(false)
        const message = ref({ type: '', text: '' })

        // å•ä¸ªåœºæ™¯ä¸Šä¼ è¡¨å•
        const singleScene = ref({
          id: '',
          name: '',
          duration: 90,
          content: '',
          filename: '',
          theme: ''
        })

        // æ‰¹é‡ä¸Šä¼ 
        const batchScenes = ref('')

        // æµ‹è¯•å·¥ä½œæµ
        const testScene = ref({
          id: '',
          name: '',
          duration: 90,
          content: '',
          filename: '',
          theme: ''
        })
        const testStatus = ref({
          validating: false,
          uploading: false,
          starting: false,
          validated: false,
          uploaded: false,
          previewRunning: false,
          previewUrl: null,
          errors: [],
          warnings: []
        })

        // ä¸»é¢˜é€‰é¡¹
        const themes = [
          { value: '', label: 'é»˜è®¤' },
          { value: 'tech', label: 'ç§‘æŠ€è“' },
          { value: 'cyberpunk', label: 'èµ›åšæœ‹å…‹' },
          { value: 'elegant', label: 'ä¼˜é›…ç´«' },
          { value: 'nature', label: 'è‡ªç„¶ç»¿' },
          { value: 'warm', label: 'æ¸©æš–æ©™' },
          { value: 'minimal', label: 'æç®€é»‘ç™½' }
        ]

        // è®¡ç®—å±æ€§
        const totalDuration = computed(() => {
          return scenes.value.reduce((sum, s) => sum + s.durationInFrames, 0)
        })

        const totalSeconds = computed(() => {
          return (totalDuration.value / 30).toFixed(1)
        })

        // æ–¹æ³•
        const showMessage = (type, text) => {
          message.value = { type, text }
          setTimeout(() => {
            message.value = { type: '', text: '' }
          }, 3000)
        }

        const fetchScenes = async () => {
          try {
            loading.value = true
            const response = await fetch(`${API_BASE}/scenes`)
            const data = await response.json()
            scenes.value = data.scenes || []
            manifest.value = data.manifest
          } catch (error) {
            showMessage('error', 'è·å–åœºæ™¯åˆ—è¡¨å¤±è´¥: ' + error.message)
          } finally {
            loading.value = false
          }
        }

        const uploadSingleScene = async () => {
          if (!singleScene.value.id || !singleScene.value.name || !singleScene.value.content) {
            showMessage('error', 'è¯·å¡«å†™å¿…å¡«å­—æ®µï¼ˆIDã€åç§°ã€ä»£ç ï¼‰')
            return
          }

          try {
            loading.value = true
            const response = await fetch(`${API_BASE}/push`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                scene_id: singleScene.value.id,
                scene_name: singleScene.value.name,
                duration: parseInt(singleScene.value.duration),
                code_content: singleScene.value.content,
                filename: singleScene.value.filename || undefined,
                theme: singleScene.value.theme || undefined
              })
            })

            const data = await response.json()
            
            if (data.success) {
              showMessage('success', 'åœºæ™¯ä¸Šä¼ æˆåŠŸï¼')
              singleScene.value = { id: '', name: '', duration: 90, content: '', filename: '', theme: '' }
              await fetchScenes()
            } else {
              showMessage('error', data.message || 'ä¸Šä¼ å¤±è´¥')
            }
          } catch (error) {
            showMessage('error', 'ä¸Šä¼ å¤±è´¥: ' + error.message)
          } finally {
            loading.value = false
          }
        }

        const uploadBatchScenes = async () => {
          if (!batchScenes.value.trim()) {
            showMessage('error', 'è¯·è¾“å…¥æ‰¹é‡åœºæ™¯ JSON')
            return
          }

          try {
            const scenesData = JSON.parse(batchScenes.value)
            loading.value = true
            
            const response = await fetch(`${API_BASE}/push-batch`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ scenes: scenesData })
            })

            const data = await response.json()
            
            if (data.success) {
              showMessage('success', `æ‰¹é‡ä¸Šä¼ æˆåŠŸï¼${data.success_count}/${data.total} ä¸ªåœºæ™¯`)
              batchScenes.value = ''
              await fetchScenes()
            } else {
              showMessage('error', data.message || 'æ‰¹é‡ä¸Šä¼ å¤±è´¥')
            }
          } catch (error) {
            showMessage('error', 'æ‰¹é‡ä¸Šä¼ å¤±è´¥: ' + error.message)
          } finally {
            loading.value = false
          }
        }

        const deleteScene = async (sceneId) => {
          if (!confirm(`ç¡®å®šè¦åˆ é™¤åœºæ™¯ "${sceneId}" å—ï¼Ÿ`)) return

          try {
            loading.value = true
            const response = await fetch(`${API_BASE}/delete/${sceneId}`, {
              method: 'DELETE'
            })

            const data = await response.json()
            
            if (data.success) {
              showMessage('success', 'åœºæ™¯åˆ é™¤æˆåŠŸï¼')
              await fetchScenes()
            } else {
              showMessage('error', data.message || 'åˆ é™¤å¤±è´¥')
            }
          } catch (error) {
            showMessage('error', 'åˆ é™¤å¤±è´¥: ' + error.message)
          } finally {
            loading.value = false
          }
        }

        const setTheme = async (theme) => {
          try {
            loading.value = true
            const response = await fetch(`${API_BASE}/set-theme`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ theme })
            })

            const data = await response.json()
            
            if (data.success) {
              showMessage('success', `ä¸»é¢˜å·²è®¾ç½®ä¸º: ${theme}`)
              await fetchScenes()
            } else {
              showMessage('error', data.message || 'è®¾ç½®ä¸»é¢˜å¤±è´¥')
            }
          } catch (error) {
            showMessage('error', 'è®¾ç½®ä¸»é¢˜å¤±è´¥: ' + error.message)
          } finally {
            loading.value = false
          }
        }

        const loadExample = () => {
          singleScene.value = {
            id: 'scene-example',
            name: 'DNA ä»‹ç»',
            duration: 90,
            content: `import React from "react";
import { AbsoluteFill } from "remotion";
import { TitleCard } from "../components";

export default function SceneExample() {
  return (
    <AbsoluteFill style={{ backgroundColor: "#0f172a" }}>
      <TitleCard title="DNA åŒé“¾ç»“æ„" subtitle="ç”Ÿå‘½çš„è“å›¾" />
    </AbsoluteFill>
  );
}`,
            filename: '',
            theme: 'tech'
          }
        }

        const loadBatchExample = () => {
          batchScenes.value = JSON.stringify([
            {
              id: "scene-1",
              name: "æ ‡é¢˜ä»‹ç»",
              duration: 90,
              content: "import React from \"react\";\nimport { AbsoluteFill } from \"remotion\";\nimport { TitleCard } from \"../components\";\n\nexport default function Scene1() {\n  return (\n    <AbsoluteFill style={{ backgroundColor: \"#0f172a\" }}>\n      <TitleCard title=\"DNA åŒé“¾ç»“æ„\" subtitle=\"ç”Ÿå‘½çš„è“å›¾\" />\n    </AbsoluteFill>\n  );\n}"
            },
            {
              id: "scene-2",
              name: "å†…å®¹è®²è§£",
              duration: 150,
              content: "import React from \"react\";\nimport { AbsoluteFill } from \"remotion\";\nimport { ListStaggeredEntry } from \"../components\";\n\nexport default function Scene2() {\n  return (\n    <AbsoluteFill style={{ backgroundColor: \"#0f172a\", padding: 40 }}>\n      <ListStaggeredEntry items={[\"è…ºå˜Œå‘¤ (A)\", \"èƒ¸è…ºå˜§å•¶ (T)\", \"é¸Ÿå˜Œå‘¤ (G)\", \"èƒå˜§å•¶ (C)\"]} />\n    </AbsoluteFill>\n  );\n}"
            }
          ], null, 2)
        }

        const loadTestExample = () => {
          testScene.value = {
            id: 'scene-test',
            name: 'æµ‹è¯•åœºæ™¯',
            duration: 90,
            content: `import React from "react";
import { AbsoluteFill } from "remotion";
import { TitleCard } from "../components";

export default function SceneTest() {
  return (
    <AbsoluteFill style={{ backgroundColor: "#0f172a" }}>
      <TitleCard 
        title="å¿«é€Ÿæµ‹è¯•" 
        subtitle="éªŒè¯åœºæ™¯ä»£ç æ˜¯å¦æ­£å¸¸å·¥ä½œ" 
      />
    </AbsoluteFill>
  );
}`,
            filename: '',
            theme: 'tech'
          }
          resetTestStatus()
        }

        const resetTestStatus = () => {
          testStatus.value = {
            validating: false,
            uploading: false,
            starting: false,
            validated: false,
            uploaded: false,
            previewRunning: false,
            previewUrl: null,
            errors: [],
            warnings: []
          }
        }

        const validateCode = async () => {
          if (!testScene.value.content) {
            showMessage('error', 'è¯·è¾“å…¥åœºæ™¯ä»£ç ')
            return
          }

          try {
            testStatus.value.validating = true
            const response = await fetch(`${API_BASE}/test/validate`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                code_content: testScene.value.content
              })
            })

            const data = await response.json()
            testStatus.value.validated = data.success
            testStatus.value.errors = data.errors || []
            testStatus.value.warnings = data.warnings || []

            if (data.success) {
              showMessage('success', 'âœ… ä»£ç éªŒè¯é€šè¿‡ï¼')
            } else {
              showMessage('error', 'âŒ ä»£ç éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯')
            }
          } catch (error) {
            showMessage('error', 'éªŒè¯å¤±è´¥: ' + error.message)
          } finally {
            testStatus.value.validating = false
          }
        }

        const uploadTestScene = async () => {
          if (!testScene.value.id || !testScene.value.name || !testScene.value.content) {
            showMessage('error', 'è¯·å¡«å†™å¿…å¡«å­—æ®µ')
            return
          }

          try {
            testStatus.value.uploading = true
            const response = await fetch(`${API_BASE}/push`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                scene_id: testScene.value.id,
                scene_name: testScene.value.name,
                duration: parseInt(testScene.value.duration),
                code_content: testScene.value.content,
                filename: testScene.value.filename || undefined,
                theme: testScene.value.theme || undefined
              })
            })

            const data = await response.json()
            
            if (data.success) {
              testStatus.value.uploaded = true
              showMessage('success', 'âœ… åœºæ™¯ä¸Šä¼ æˆåŠŸï¼')
              await fetchScenes()
            } else {
              showMessage('error', data.message || 'ä¸Šä¼ å¤±è´¥')
            }
          } catch (error) {
            showMessage('error', 'ä¸Šä¼ å¤±è´¥: ' + error.message)
          } finally {
            testStatus.value.uploading = false
          }
        }

        const checkPreviewStatus = async () => {
          try {
            const response = await fetch(`${API_BASE}/test/preview-status`)
            const data = await response.json()
            
            testStatus.value.previewRunning = data.is_running
            testStatus.value.previewUrl = data.url
            
            return data.is_running
          } catch (error) {
            console.error('æ£€æŸ¥é¢„è§ˆçŠ¶æ€å¤±è´¥:', error)
            return false
          }
        }

        const startPreview = async () => {
          try {
            testStatus.value.starting = true
            const response = await fetch(`${API_BASE}/test/start-preview`, {
              method: 'POST'
            })

            const data = await response.json()
            
            if (data.success) {
              testStatus.value.previewUrl = data.url
              
              if (data.already_running) {
                testStatus.value.previewRunning = true
                showMessage('success', 'âœ… Remotion Studio å·²åœ¨è¿è¡Œ')
              } else {
                showMessage('success', 'ğŸš€ Remotion Studio æ­£åœ¨å¯åŠ¨ï¼Œè¯·ç¨å€™...')
                // ç­‰å¾…å‡ ç§’åæ£€æŸ¥çŠ¶æ€
                setTimeout(async () => {
                  await checkPreviewStatus()
                  if (testStatus.value.previewRunning) {
                    showMessage('success', 'âœ… Remotion Studio å¯åŠ¨æˆåŠŸï¼')
                  }
                }, 5000)
              }
            } else {
              showMessage('error', data.message || 'å¯åŠ¨å¤±è´¥')
            }
          } catch (error) {
            showMessage('error', 'å¯åŠ¨å¤±è´¥: ' + error.message)
          } finally {
            testStatus.value.starting = false
          }
        }

        const runFullWorkflow = async () => {
          if (!testScene.value.id || !testScene.value.name || !testScene.value.content) {
            showMessage('error', 'è¯·å¡«å†™å¿…å¡«å­—æ®µ')
            return
          }

          resetTestStatus()

          // æ­¥éª¤ 1: éªŒè¯ä»£ç 
          showMessage('success', 'ğŸ” æ­¥éª¤ 1/3: éªŒè¯ä»£ç ...')
          await validateCode()
          
          if (!testStatus.value.validated) {
            showMessage('error', 'âŒ ä»£ç éªŒè¯å¤±è´¥ï¼Œå·¥ä½œæµä¸­æ­¢')
            return
          }

          // ç­‰å¾… 1 ç§’
          await new Promise(resolve => setTimeout(resolve, 1000))

          // æ­¥éª¤ 2: ä¸Šä¼ åœºæ™¯
          showMessage('success', 'ğŸ“¤ æ­¥éª¤ 2/3: ä¸Šä¼ åœºæ™¯...')
          await uploadTestScene()
          
          if (!testStatus.value.uploaded) {
            showMessage('error', 'âŒ åœºæ™¯ä¸Šä¼ å¤±è´¥ï¼Œå·¥ä½œæµä¸­æ­¢')
            return
          }

          // ç­‰å¾… 1 ç§’
          await new Promise(resolve => setTimeout(resolve, 1000))

          // æ­¥éª¤ 3: å¯åŠ¨é¢„è§ˆ
          showMessage('success', 'ğŸš€ æ­¥éª¤ 3/3: å¯åŠ¨é¢„è§ˆ...')
          await startPreview()

          // æœ€ç»ˆæç¤º
          setTimeout(() => {
            if (testStatus.value.previewUrl) {
              showMessage('success', 'âœ… æµ‹è¯•å·¥ä½œæµå®Œæˆï¼å¯ä»¥åœ¨é¢„è§ˆçª—å£æŸ¥çœ‹æ•ˆæœ')
            }
          }, 2000)
        }

        // ç”Ÿå‘½å‘¨æœŸ
        onMounted(() => {
          fetchScenes()
          checkPreviewStatus()
        })

        return {
          activeTab,
          scenes,
          manifest,
          loading,
          message,
          singleScene,
          batchScenes,
          testScene,
          testStatus,
          themes,
          totalDuration,
          totalSeconds,
          fetchScenes,
          uploadSingleScene,
          uploadBatchScenes,
          deleteScene,
          setTheme,
          loadExample,
          loadBatchExample,
          loadTestExample,
          validateCode,
          uploadTestScene,
          checkPreviewStatus,
          startPreview,
          runFullWorkflow
        }
      },

      template: `
        <div class="container mx-auto px-4 py-8 max-w-7xl">
          <!-- å¤´éƒ¨ -->
          <header class="mb-8">
            <div class="flex items-center justify-between">
              <div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                  åœºæ™¯ä¸Šä¼ ç®¡ç†å™¨
                </h1>
                <p class="text-slate-400 mt-2">X-Pilot Video Render - å¯è§†åŒ–åœºæ™¯ç®¡ç†å·¥å…·</p>
              </div>
              <div class="text-right">
                <div class="text-sm text-slate-400">æ€»åœºæ™¯æ•°</div>
                <div class="text-3xl font-bold text-blue-400">{{ scenes.length }}</div>
              </div>
            </div>
          </header>

          <!-- æ¶ˆæ¯æç¤º -->
          <div v-if="message.text" 
               :class="[
                 'mb-6 p-4 rounded-lg border',
                 message.type === 'success' ? 'bg-green-500/10 border-green-500 text-green-400' : 'bg-red-500/10 border-red-500 text-red-400'
               ]">
            {{ message.text }}
          </div>

          <!-- æ ‡ç­¾é¡µ -->
          <div class="mb-6 border-b border-slate-700">
            <nav class="flex space-x-8">
              <button @click="activeTab = 'upload'" 
                      :class="[
                        'pb-4 px-1 border-b-2 font-medium transition-colors',
                        activeTab === 'upload' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-300'
                      ]">
                ğŸ“¤ ä¸Šä¼ åœºæ™¯
              </button>
              <button @click="activeTab = 'batch'" 
                      :class="[
                        'pb-4 px-1 border-b-2 font-medium transition-colors',
                        activeTab === 'batch' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-300'
                      ]">
                ğŸ“¦ æ‰¹é‡ä¸Šä¼ 
              </button>
              <button @click="activeTab = 'test'" 
                      :class="[
                        'pb-4 px-1 border-b-2 font-medium transition-colors',
                        activeTab === 'test' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-300'
                      ]">
                ğŸ§ª å¿«é€Ÿæµ‹è¯•
              </button>
              <button @click="activeTab = 'list'" 
                      :class="[
                        'pb-4 px-1 border-b-2 font-medium transition-colors',
                        activeTab === 'list' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-300'
                      ]">
                ğŸ“‹ åœºæ™¯åˆ—è¡¨
              </button>
              <button @click="activeTab = 'manifest'" 
                      :class="[
                        'pb-4 px-1 border-b-2 font-medium transition-colors',
                        activeTab === 'manifest' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-300'
                      ]">
                âš™ï¸ é…ç½®
              </button>
            </nav>
          </div>

          <!-- å•ä¸ªä¸Šä¼  -->
          <div v-show="activeTab === 'upload'" class="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-2xl font-semibold">ä¸Šä¼ å•ä¸ªåœºæ™¯</h2>
              <button @click="loadExample" class="text-sm text-blue-400 hover:text-blue-300">
                ğŸ“ åŠ è½½ç¤ºä¾‹
              </button>
            </div>

            <div class="grid grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">åœºæ™¯ ID *</label>
                <input v-model="singleScene.id" 
                       type="text" 
                       placeholder="scene-1"
                       class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500">
              </div>

              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">åœºæ™¯åç§° *</label>
                <input v-model="singleScene.name" 
                       type="text" 
                       placeholder="DNA ä»‹ç»"
                       class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500">
              </div>

              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">æŒç»­å¸§æ•° *</label>
                <input v-model="singleScene.duration" 
                       type="number" 
                       placeholder="90"
                       class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500">
                <p class="text-xs text-slate-500 mt-1">{{ (singleScene.duration / 30).toFixed(1) }} ç§’ (30fps)</p>
              </div>

              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰</label>
                <input v-model="singleScene.filename" 
                       type="text" 
                       placeholder="Scene1.tsx"
                       class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500">
              </div>

              <div class="col-span-2">
                <label class="block text-sm font-medium text-slate-300 mb-2">ä¸»é¢˜ï¼ˆå¯é€‰ï¼‰</label>
                <select v-model="singleScene.theme" 
                        class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500">
                  <option v-for="theme in themes" :key="theme.value" :value="theme.value">
                    {{ theme.label }}
                  </option>
                </select>
              </div>

              <div class="col-span-2">
                <label class="block text-sm font-medium text-slate-300 mb-2">åœºæ™¯ä»£ç  *</label>
                <textarea v-model="singleScene.content" 
                          rows="12"
                          placeholder="import React from 'react'..."
                          class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500 code-editor text-sm"></textarea>
              </div>
            </div>

            <button @click="uploadSingleScene" 
                    :disabled="loading"
                    class="mt-6 w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold py-3 rounded-lg transition-all">
              {{ loading ? 'ä¸Šä¼ ä¸­...' : 'ğŸš€ ä¸Šä¼ åœºæ™¯' }}
            </button>
          </div>

          <!-- æ‰¹é‡ä¸Šä¼  -->
          <div v-show="activeTab === 'batch'" class="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-2xl font-semibold">æ‰¹é‡ä¸Šä¼ åœºæ™¯</h2>
              <button @click="loadBatchExample" class="text-sm text-blue-400 hover:text-blue-300">
                ğŸ“ åŠ è½½ç¤ºä¾‹
              </button>
            </div>

            <div class="mb-4">
              <label class="block text-sm font-medium text-slate-300 mb-2">åœºæ™¯ JSON æ•°ç»„</label>
              <textarea v-model="batchScenes" 
                        rows="20"
                        placeholder='[{"id": "scene-1", "name": "æ ‡é¢˜", "duration": 90, "content": "..."}]'
                        class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500 code-editor text-sm"></textarea>
              <p class="text-xs text-slate-500 mt-2">
                æ ¼å¼ï¼š[{ id, name, duration, content, filename?, theme? }]
              </p>
            </div>

            <button @click="uploadBatchScenes" 
                    :disabled="loading"
                    class="w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold py-3 rounded-lg transition-all">
              {{ loading ? 'ä¸Šä¼ ä¸­...' : 'ğŸš€ æ‰¹é‡ä¸Šä¼ ' }}
            </button>
          </div>

          <!-- å¿«é€Ÿæµ‹è¯•å·¥ä½œæµ -->
          <div v-show="activeTab === 'test'" class="space-y-6">
            <!-- å·¥ä½œæµçŠ¶æ€å¡ç‰‡ -->
            <div class="bg-gradient-to-r from-blue-500/10 to-purple-500/10 backdrop-blur rounded-xl p-6 border border-blue-500/30">
              <h2 class="text-2xl font-semibold mb-4 flex items-center">
                ğŸ§ª å¿«é€Ÿæµ‹è¯•å·¥ä½œæµ
                <span class="ml-3 text-sm font-normal text-slate-400">ä¸Šä¼  â†’ éªŒè¯ â†’ é¢„è§ˆ</span>
              </h2>
              
              <!-- å·¥ä½œæµæ­¥éª¤æŒ‡ç¤ºå™¨ -->
              <div class="grid grid-cols-3 gap-4 mb-6">
                <div :class="[
                  'p-4 rounded-lg border-2 transition-all',
                  testStatus.validated ? 'border-green-500 bg-green-500/10' : 'border-slate-600 bg-slate-800/50'
                ]">
                  <div class="text-center">
                    <div class="text-3xl mb-2">{{ testStatus.validated ? 'âœ…' : 'ğŸ”' }}</div>
                    <div class="font-semibold">æ­¥éª¤ 1: éªŒè¯ä»£ç </div>
                    <div class="text-xs text-slate-400 mt-1">
                      {{ testStatus.validating ? 'éªŒè¯ä¸­...' : testStatus.validated ? 'éªŒè¯é€šè¿‡' : 'å¾…éªŒè¯' }}
                    </div>
                  </div>
                </div>

                <div :class="[
                  'p-4 rounded-lg border-2 transition-all',
                  testStatus.uploaded ? 'border-green-500 bg-green-500/10' : 'border-slate-600 bg-slate-800/50'
                ]">
                  <div class="text-center">
                    <div class="text-3xl mb-2">{{ testStatus.uploaded ? 'âœ…' : 'ğŸ“¤' }}</div>
                    <div class="font-semibold">æ­¥éª¤ 2: ä¸Šä¼ åœºæ™¯</div>
                    <div class="text-xs text-slate-400 mt-1">
                      {{ testStatus.uploading ? 'ä¸Šä¼ ä¸­...' : testStatus.uploaded ? 'ä¸Šä¼ æˆåŠŸ' : 'å¾…ä¸Šä¼ ' }}
                    </div>
                  </div>
                </div>

                <div :class="[
                  'p-4 rounded-lg border-2 transition-all',
                  testStatus.previewRunning ? 'border-green-500 bg-green-500/10' : 'border-slate-600 bg-slate-800/50'
                ]">
                  <div class="text-center">
                    <div class="text-3xl mb-2">{{ testStatus.previewRunning ? 'âœ…' : 'ğŸš€' }}</div>
                    <div class="font-semibold">æ­¥éª¤ 3: å¯åŠ¨é¢„è§ˆ</div>
                    <div class="text-xs text-slate-400 mt-1">
                      {{ testStatus.starting ? 'å¯åŠ¨ä¸­...' : testStatus.previewRunning ? 'è¿è¡Œä¸­' : 'å¾…å¯åŠ¨' }}
                    </div>
                  </div>
                </div>
              </div>

              <!-- éªŒè¯ç»“æœ -->
              <div v-if="testStatus.errors.length > 0 || testStatus.warnings.length > 0" class="space-y-2 mb-4">
                <div v-if="testStatus.errors.length > 0" class="bg-red-500/10 border border-red-500 rounded-lg p-3">
                  <div class="font-semibold text-red-400 mb-2">âŒ é”™è¯¯:</div>
                  <ul class="text-sm text-red-300 space-y-1">
                    <li v-for="(error, i) in testStatus.errors" :key="i">â€¢ {{ error }}</li>
                  </ul>
                </div>
                <div v-if="testStatus.warnings.length > 0" class="bg-yellow-500/10 border border-yellow-500 rounded-lg p-3">
                  <div class="font-semibold text-yellow-400 mb-2">âš ï¸ è­¦å‘Š:</div>
                  <ul class="text-sm text-yellow-300 space-y-1">
                    <li v-for="(warning, i) in testStatus.warnings" :key="i">â€¢ {{ warning }}</li>
                  </ul>
                </div>
              </div>

              <!-- é¢„è§ˆé“¾æ¥ -->
              <div v-if="testStatus.previewUrl" class="bg-blue-500/10 border border-blue-500 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-semibold text-blue-400 mb-1">ğŸ¬ é¢„è§ˆåœ°å€</div>
                    <a :href="testStatus.previewUrl" target="_blank" class="text-sm text-blue-300 hover:underline">
                      {{ testStatus.previewUrl }}
                    </a>
                  </div>
                  <a :href="testStatus.previewUrl" target="_blank" 
                     class="px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg text-white font-semibold transition-colors">
                    æ‰“å¼€é¢„è§ˆ â†’
                  </a>
                </div>
              </div>
            </div>

            <!-- åœºæ™¯ç¼–è¾‘è¡¨å• -->
            <div class="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
              <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">åœºæ™¯é…ç½®</h3>
                <button @click="loadTestExample" class="text-sm text-blue-400 hover:text-blue-300">
                  ğŸ“ åŠ è½½ç¤ºä¾‹
                </button>
              </div>

              <div class="grid grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-slate-300 mb-2">åœºæ™¯ ID *</label>
                  <input v-model="testScene.id" 
                         type="text" 
                         placeholder="scene-test"
                         class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div>
                  <label class="block text-sm font-medium text-slate-300 mb-2">åœºæ™¯åç§° *</label>
                  <input v-model="testScene.name" 
                         type="text" 
                         placeholder="æµ‹è¯•åœºæ™¯"
                         class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div>
                  <label class="block text-sm font-medium text-slate-300 mb-2">æŒç»­å¸§æ•° *</label>
                  <input v-model="testScene.duration" 
                         type="number" 
                         placeholder="90"
                         class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500">
                  <p class="text-xs text-slate-500 mt-1">{{ (testScene.duration / 30).toFixed(1) }} ç§’ (30fps)</p>
                </div>

                <div>
                  <label class="block text-sm font-medium text-slate-300 mb-2">ä¸»é¢˜</label>
                  <select v-model="testScene.theme" 
                          class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500">
                    <option v-for="theme in themes" :key="theme.value" :value="theme.value">
                      {{ theme.label }}
                    </option>
                  </select>
                </div>

                <div class="col-span-2">
                  <label class="block text-sm font-medium text-slate-300 mb-2">åœºæ™¯ä»£ç  *</label>
                  <textarea v-model="testScene.content" 
                            rows="14"
                            placeholder="import React from 'react'..."
                            class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500 code-editor text-sm"></textarea>
                </div>
              </div>

              <!-- æ“ä½œæŒ‰é’® -->
              <div class="grid grid-cols-4 gap-3 mt-6">
                <button @click="validateCode" 
                        :disabled="testStatus.validating"
                        class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold py-3 rounded-lg transition-all">
                  {{ testStatus.validating ? 'éªŒè¯ä¸­...' : 'ğŸ” éªŒè¯ä»£ç ' }}
                </button>

                <button @click="uploadTestScene" 
                        :disabled="testStatus.uploading || !testStatus.validated"
                        class="bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold py-3 rounded-lg transition-all">
                  {{ testStatus.uploading ? 'ä¸Šä¼ ä¸­...' : 'ğŸ“¤ ä¸Šä¼ åœºæ™¯' }}
                </button>

                <button @click="startPreview" 
                        :disabled="testStatus.starting"
                        class="bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold py-3 rounded-lg transition-all">
                  {{ testStatus.starting ? 'å¯åŠ¨ä¸­...' : 'ğŸš€ å¯åŠ¨é¢„è§ˆ' }}
                </button>

                <button @click="runFullWorkflow" 
                        :disabled="loading || testStatus.validating || testStatus.uploading || testStatus.starting"
                        class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold py-3 rounded-lg transition-all">
                  âš¡ ä¸€é”®æµ‹è¯•
                </button>
              </div>

              <div class="mt-4 text-sm text-slate-400 bg-slate-900/50 rounded-lg p-3">
                <div class="font-semibold mb-2">ğŸ’¡ ä½¿ç”¨æç¤º:</div>
                <ul class="space-y-1 text-xs">
                  <li>â€¢ <strong>éªŒè¯ä»£ç </strong>: æ£€æŸ¥ä»£ç è¯­æ³•å’Œå¿…è¦çš„å¯¼å…¥</li>
                  <li>â€¢ <strong>ä¸Šä¼ åœºæ™¯</strong>: å°†åœºæ™¯ä»£ç ä¿å­˜åˆ°é¡¹ç›®ä¸­</li>
                  <li>â€¢ <strong>å¯åŠ¨é¢„è§ˆ</strong>: å¯åŠ¨ Remotion Studio æŸ¥çœ‹æ•ˆæœ</li>
                  <li>â€¢ <strong>ä¸€é”®æµ‹è¯•</strong>: è‡ªåŠ¨æ‰§è¡Œå®Œæ•´å·¥ä½œæµï¼ˆæ¨èï¼‰</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- åœºæ™¯åˆ—è¡¨ -->
          <div v-show="activeTab === 'list'" class="space-y-4">
            <div class="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
              <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold">åœºæ™¯åˆ—è¡¨</h2>
                <div class="text-sm text-slate-400">
                  æ€»æ—¶é•¿: <span class="text-blue-400 font-semibold">{{ totalSeconds }}s</span> 
                  ({{ totalDuration }} å¸§)
                </div>
              </div>

              <div v-if="loading" class="text-center py-8 text-slate-400">
                åŠ è½½ä¸­...
              </div>

              <div v-else-if="scenes.length === 0" class="text-center py-8 text-slate-400">
                æš‚æ— åœºæ™¯ï¼Œè¯·å…ˆä¸Šä¼ 
              </div>

              <div v-else class="space-y-3">
                <div v-for="(scene, index) in scenes" 
                     :key="scene.id"
                     class="bg-slate-900/50 rounded-lg p-4 border border-slate-700 hover:border-slate-600 transition-colors">
                  <div class="flex items-start justify-between">
                    <div class="flex-1">
                      <div class="flex items-center space-x-3 mb-2">
                        <span class="text-slate-500 font-mono text-sm">{{ index + 1 }}</span>
                        <h3 class="text-lg font-semibold text-blue-400">{{ scene.name }}</h3>
                        <span class="text-xs px-2 py-1 bg-slate-700 rounded">{{ scene.id }}</span>
                      </div>
                      <div class="flex items-center space-x-4 text-sm text-slate-400">
                        <span>ğŸ“„ {{ scene.component }}</span>
                        <span>â±ï¸ {{ scene.durationInFrames }} å¸§ ({{ (scene.durationInFrames / 30).toFixed(1) }}s)</span>
                        <span v-if="scene.props" class="text-purple-400">ğŸ¨ æœ‰å±æ€§</span>
                      </div>
                    </div>
                    <button @click="deleteScene(scene.id)" 
                            class="text-red-400 hover:text-red-300 text-sm px-3 py-1 border border-red-500/50 rounded hover:bg-red-500/10 transition-colors">
                      ğŸ—‘ï¸ åˆ é™¤
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- é…ç½® -->
          <div v-show="activeTab === 'manifest'" class="space-y-4">
            <div class="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
              <h2 class="text-2xl font-semibold mb-4">è§†é¢‘é…ç½®</h2>
              
              <div v-if="manifest" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                  <div class="bg-slate-900/50 rounded-lg p-4">
                    <div class="text-sm text-slate-400 mb-1">åˆ†è¾¨ç‡</div>
                    <div class="text-xl font-semibold">{{ manifest.width }} Ã— {{ manifest.height }}</div>
                  </div>
                  <div class="bg-slate-900/50 rounded-lg p-4">
                    <div class="text-sm text-slate-400 mb-1">å¸§ç‡</div>
                    <div class="text-xl font-semibold">{{ manifest.fps }} fps</div>
                  </div>
                  <div class="bg-slate-900/50 rounded-lg p-4">
                    <div class="text-sm text-slate-400 mb-1">å½“å‰ä¸»é¢˜</div>
                    <div class="text-xl font-semibold text-purple-400">{{ manifest.theme || 'tech' }}</div>
                  </div>
                  <div class="bg-slate-900/50 rounded-lg p-4">
                    <div class="text-sm text-slate-400 mb-1">ç‰ˆæœ¬</div>
                    <div class="text-xl font-semibold">{{ manifest.version }}</div>
                  </div>
                </div>

                <div class="mt-6">
                  <label class="block text-sm font-medium text-slate-300 mb-2">åˆ‡æ¢ä¸»é¢˜</label>
                  <div class="grid grid-cols-3 gap-3">
                    <button v-for="theme in themes.filter(t => t.value)" 
                            :key="theme.value"
                            @click="setTheme(theme.value)"
                            :class="[
                              'px-4 py-3 rounded-lg border transition-all',
                              manifest.theme === theme.value 
                                ? 'border-blue-500 bg-blue-500/20 text-blue-400' 
                                : 'border-slate-600 bg-slate-900/50 text-slate-300 hover:border-slate-500'
                            ]">
                      {{ theme.label }}
                    </button>
                  </div>
                </div>

                <div class="mt-6">
                  <label class="block text-sm font-medium text-slate-300 mb-2">manifest.json é¢„è§ˆ</label>
                  <pre class="bg-slate-900 rounded-lg p-4 text-xs code-editor overflow-x-auto border border-slate-700">{{ JSON.stringify(manifest, null, 2) }}</pre>
                </div>
              </div>
            </div>
          </div>

          <!-- é¡µè„š -->
          <footer class="mt-8 text-center text-slate-500 text-sm">
            <p>X-Pilot Video Render Â© 2024 | åœºæ™¯ç®¡ç†å·¥å…·</p>
            <p class="mt-1">API åœ°å€: <code class="text-blue-400">{{ '${API_BASE}' }}</code></p>
          </footer>
        </div>
      `
    }).mount('#app')
  </script>
</body>
</html>
